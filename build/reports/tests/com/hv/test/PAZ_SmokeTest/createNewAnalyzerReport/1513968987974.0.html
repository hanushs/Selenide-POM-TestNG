<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><!-- /*!
 * HITACHI VANTARA PROPRIETARY AND CONFIDENTIAL
 *
 * Copyright 2002 - 2017 Hitachi Vantara. All rights reserved.
 *
 * NOTICE: All information including source code contained herein is, and
 * remains the sole property of Hitachi Vantara and its licensors. The intellectual
 * and technical concepts contained herein are proprietary and confidential
 * to, and are trade secrets of Hitachi Vantara and may be covered by U.S. and foreign
 * patents, or patents in process, and are protected by trade secret and
 * copyright laws. The receipt or possession of this source code and/or related
 * information does not convey or imply any rights to reproduce, disclose or
 * distribute its contents, or to manufacture, use, or sell anything that it
 * may describe, in whole or in part. Any reproduction, modification, distribution,
 * or public display of this information without the express written authorization
 * from Hitachi Vantara is strictly prohibited and in violation of applicable laws and
 * international treaties. Access to the source code contained herein is strictly
 * prohibited to anyone except those individuals and entities who have executed
 * confidentiality and non-disclosure agreements or other agreements with Hitachi Vantara,
 * explicitly covering such access.
 */ --><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Create New Report - Select Data Source</title>


    <meta name="helpTopic" content="CV/Business_User/creating_a_new_report.html#choosing_an_analysis_area" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" media="all" href="../styles/common.css" />
    <link rel="stylesheet" type="text/css" media="all" href="../styles/content.css" />
    <link rel="stylesheet" type="text/css" media="all" href="../styles/report/selectArea.css" />
    <link rel="stylesheet" href="../scripts/filechooser/Widgets.css" />
    <link rel="stylesheet" type="text/css" media="only screen and (max-device-width: 1024px)" href="../styles/ipad.css" />

    <script type="text/javascript" src="/pentaho/js/themeResources.js"></script><script type="text/javascript">

        // Collect an array of Visualization plugin AMD modules to load, plugins add to this array through webcontext.js
        var analyzerVizPlugins = [];

        // djConfig["baseUrl"] = "scripts/dojo/dojo/";
        var debug = false;

        var cv = {};

    </script>

    <script language="javascript" type="text/javascript" src="webcontext.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/reporting/reportviewer/reporting-require-js-cfg.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/pentaho-interactive-reporting/resources/web/pir-require-js-cfg.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/pentaho-geo/resources/web/geo-require-js-cfg.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/pentaho-cdf-dd/js/cde-core-require-js-cfg.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/pentaho-cdf-dd/js/cde-pentaho-require-js-cfg.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/pentaho-cdf/js/cdf-require-js-cfg.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/js/require-js-cfg.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/api/repos/dashboards/script/dashboards-require-js-cfg.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/common-ui/resources/web/common-ui-require-js-cfg.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/client-config-folder-enabler/client-config-enabler-require-js-cfg.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/analyzer/scripts/analyzer-require-js-cfg.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/admin-plugin/resources/admin-plugin-require-js-cfg.js?context=analyzer"></script><script type="text/javascript" src="/pentaho/content/common-ui/resources/web/require.js"></script><script type="text/javascript" src="/pentaho/content/common-ui/resources/web/require-cfg.js"></script><script type="text/javascript" src="/pentaho/osgi/requirejs-manager/js/require-init.js?requirejs=false"></script><script language="javascript" type="text/javascript" src="/pentaho/js/themes.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/common-ui/resources/themes/jquery.js?context=analyzer"></script><link rel="stylesheet" type="text/css" href="/pentaho/content/common-ui/resources/themes/ruby/globalRuby.css" /><link rel="stylesheet" type="text/css" href="/pentaho/content/common-ui/resources/themes/ruby/bootstrap/css/bootstrap-namespaced.css" /><link rel="stylesheet" type="text/css" href="/pentaho/content/analyzer/styles/themes/ruby/anaRuby.css" /><link rel="stylesheet" type="text/css" href="/pentaho/content/data-access/resources/gwt/datasourceEditorDialog.css?context=analyzer" /><link rel="stylesheet" type="text/css" href="/pentaho/content/data-access/resources/gwt/datasourceAdminDialog.css?context=analyzer" /><link rel="stylesheet" type="text/css" href="/pentaho/content/common-ui/resources/web/angular-directives/angular-directives.css?context=analyzer" /><script language="javascript" type="text/javascript" src="/pentaho/content/common-ui/resources/web/dojo/djConfig.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/common-ui/resources/web/cache/cache-service.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/common-ui/resources/themes/jquery.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/common-ui/resources/themes/themeUtils.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/common-ui/resources/web/util/URLEncoder.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/common-ui/resources/web/util/SessionExpiryCheckStartingPoint.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/pentaho-geo/resources/web/geo_analyzer_plugin_loader.js?context=analyzer"></script><link rel="stylesheet" type="text/css" href="/pentaho/content/pentaho-geo/resources/web/openlayers_style.css?context=analyzer" /><link rel="stylesheet" type="text/css" href="/pentaho/content/pentaho-geo/resources/web/openlayers/theme/default/style.css?context=analyzer" /><script language="javascript" type="text/javascript" src="/pentaho/content/pentaho-geo/resources/web/openlayers/OpenLayers.js?context=analyzer"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="dojo/_base/lang" src="/pentaho/content/common-ui/resources/web/dojo/dojo/_base/lang.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="dojo/_base/array" src="/pentaho/content/common-ui/resources/web/dojo/dojo/_base/array.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="dojo/io-query" src="/pentaho/content/common-ui/resources/web/dojo/dojo/io-query.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="dojo/_base/kernel" src="/pentaho/content/common-ui/resources/web/dojo/pentaho/common/overrides/dojo/_base/kernel.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="dojo/has" src="/pentaho/content/common-ui/resources/web/dojo/dojo/has.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="dojo/sniff" src="/pentaho/content/common-ui/resources/web/dojo/dojo/sniff.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="dojo/_base/config" src="/pentaho/content/common-ui/resources/web/dojo/pentaho/common/overrides/dojo/_base/config.js"></script><script language="javascript" type="text/javascript" src="/pentaho/content/pentaho-geo/resources/baselayers/baselayers.js?context=analyzer"></script><script language="javascript" type="text/javascript" src="/pentaho/content/analyzer/scripts/analyzer-require-js-bundles-cfg.js?context=analyzer"></script>
    <script type="text/javascript">
        require(["analyzer/analyzer-selectSchema"], function(){
                    cv.contextPath = "../";
                }
        );
    </script>

<script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="analyzer/analyzer-selectSchema" src="/pentaho/content/analyzer/scripts/compressed/analyzer-selectSchema.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="dojo/ready" src="/pentaho/content/analyzer/scripts/compressed/oss-module.js"></script><style type="text/css">/*!
 * Copyright 2002 - 2017 Webdetails, a Hitachi Vantara company.  All rights reserved.
 *
 * This software was developed by Webdetails and is provided under the terms
 * of the Mozilla Public License, Version 2.0, or any later version. You may not use
 * this file except in compliance with the license. If you need a copy of the license,
 * please go to  http://mozilla.org/MPL/2.0/. The Initial Developer is Webdetails.
 *
 * Software distributed under the Mozilla Public License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or  implied. Please refer to
 * the license for the specific language governing your rights and limitations.
 */

.tipsy{pointer-events:none;padding:5px;font-size:10px;font-family:Arial,Helvetica,sans-serif;position:absolute;z-index:100000;}.tipsy-inner{padding:5px 8px 4px 8px;background-color:black;color:white;max-width:200px;text-align:center;}.tipsy-inner{border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px;}.tipsy-arrow{position:absolute;width:0;height:0;line-height:0;border:5px dashed #000;}.tipsy-n .tipsy-arrow{top:0px;left:50%;margin-left:-5px;border-bottom-style:solid;border-top:none;border-left-color:transparent;border-right-color:transparent;}.tipsy-nw .tipsy-arrow{top:0;left:10px;border-bottom-style:solid;border-top:none;border-left-color:transparent;border-right-color:transparent;}.tipsy-ne .tipsy-arrow{top:0;right:10px;border-bottom-style:solid;border-top:none;border-left-color:transparent;border-right-color:transparent;}.tipsy-s .tipsy-arrow{bottom:0;left:50%;margin-left:-5px;border-top-style:solid;border-bottom:none;border-left-color:transparent;border-right-color:transparent;}.tipsy-sw .tipsy-arrow{bottom:0;left:10px;border-top-style:solid;border-bottom:none;border-left-color:transparent;border-right-color:transparent;}.tipsy-se .tipsy-arrow{bottom:0;right:10px;border-top-style:solid;border-bottom:none;border-left-color:transparent;border-right-color:transparent;}.tipsy-e .tipsy-arrow{right:0;top:50%;margin-top:-5px;border-left-style:solid;border-right:none;border-top-color:transparent;border-bottom-color:transparent;}.tipsy-w .tipsy-arrow{left:0;top:50%;margin-top:-5px;border-right-style:solid;border-left:none;border-top-color:transparent;border-bottom-color:transparent;}.ccc-tt{overflow:hidden;}.ccc-tt-ds{border-collapse:collapse;border-spacing:0;text-align:left;line-height:1.5em;}.ccc-tt-ds tr{vertical-align:baseline;}.ccc-tt-ds tr td{padding:0;}.ccc-tt-ds .ccc-tt-dimLabel{font-weight:600;color:darkgray;padding-right:0.3em;white-space:nowrap;}.ccc-tt-ds .ccc-tt-dimAgg-sum .ccc-tt-dimLabel span:before{content:"\03a3\00a0";font-weight:normal;font-style:normal;font-size:1.1em;}.ccc-tt-ds .ccc-tt-dimAgg-list .ccc-tt-dimLabel span:before{content:"\22c3\00a0";font-weight:normal;font-style:normal;font-size:1.2em;}.ccc-tt-ds .ccc-tt-datumCount span:before{content:"\0023\00a0";color:darkgray;font-weight:normal;font-size:1.1em;}.ccc-tt-ds .ccc-tt-trendLabel{font-size:1.2em;font-weight:bold;}.ccc-tt-ds .ccc-tt-trendLabel td{padding-bottom:0.2em;}.ccc-tt-ds .ccc-tt-dimRoles{text-align:center;padding-left:0.3em;padding-right:0.3em;}.ccc-tt-ds .ccc-tt-roleLabel{display:none;}.ccc-tt-ds.ccc-tt-chartOrient-v .ccc-tt-role-x .ccc-tt-roleIcon:after,.ccc-tt-ds.ccc-tt-chartOrient-h .ccc-tt-role-y .ccc-tt-roleIcon:after,.ccc-tt-ds.ccc-tt-chartOrient-h .ccc-tt-role-value .ccc-tt-roleIcon:after{content:"\2194";font-size:1.2em;}.ccc-tt-ds.ccc-tt-chartOrient-v .ccc-tt-role-y .ccc-tt-roleIcon:after,.ccc-tt-ds.ccc-tt-chartOrient-h .ccc-tt-role-x .ccc-tt-roleIcon:after,.ccc-tt-ds.ccc-tt-chartOrient-v .ccc-tt-role-value .ccc-tt-roleIcon:after{content:"\2195";font-size:1.2em;}.ccc-tt-ds.ccc-tt-plot-pie .ccc-tt-role-value .ccc-tt-roleIcon:after,.ccc-tt-ds.ccc-tt-plot-sunburst .ccc-tt-role-size .ccc-tt-roleIcon:after{content:"\2220";font-size:1.5em;}.ccc-tt-ds .ccc-tt-role-multiChart .ccc-tt-roleIcon:after{content:"\229e";font-size:1.2em;}.ccc-tt-ds .ccc-tt-dimValue{padding-left:0.3em;text-align:left;}.ccc-tt-ds .ccc-tt-dimValue .ccc-tt-valuePct{color:darkgray;font-size:0.9em;}.ccc-tt-ds .ccc-tt-dimValue .ccc-tt-valuePct:before{padding-left:0.7em;content:'(';}.ccc-tt-ds .ccc-tt-dimValue .ccc-tt-valuePct:after{content:')';}.ccc-tt-ds .ccc-tt-dimValue .ccc-tt-interp{color:darkgray;font-size:0.9em;}.ccc-tt-ds .ccc-tt-dimValue .ccc-tt-interp:before{padding-left:0.7em;content:'(';}.ccc-tt-ds .ccc-tt-dimValue .ccc-tt-interp:after{content:')';}</style></head>

<body>

<script type="text/javascript">
  var isRunningIFrameInSameOrigin;
  try {
    var ignoredCheckCanReachOutToParent = window.parent.mantle_initialized;
    isRunningIFrameInSameOrigin = true;
  } catch (e) {  // Ignore "Same-origin policy" violation in embedded IFrame
    isRunningIFrameInSameOrigin = false;
  }

  var console_enabled = false;
  if(isRunningIFrameInSameOrigin) {
    console_enabled = window.parent &amp;&amp; window.parent.mantle_initialized;
  }

  if(!console_enabled){
      document.getElementsByTagName("body")[0].className += " pentaho-page-background";
  }
</script>

<div style="height:75px; clear:both"></div>

<div class="selectAreaWizard pentaho-dialog" style="position: relative;">
    <div style="cursor:default;" class="Caption">Select Data Source</div>
    <div class="dialog-content" style="padding-bottom: 8px">
        <div class="analysisArea clearfix">
            Specify which data source you want to analyze.  Each data source consists of a schema and a cube in the schema.  This will determine which fields you will have available.
            <img id="helpArea" class="helpIcon" title="Help on selecting data sources" src="../../analyzer/images/spacer.gif" onclick="cv.util.getHelp('CV/Business_User/creating_a_new_report.html#choosing_an_analysis_area')" />
        </div>
        <div id="description" class="analysisArea clearfix">
            <table>
                <tbody><tr>
                    <td width="100%">Data Sources:</td>
                    <td><img id="editDS" src="../../analyzer/images/spacer.gif" class="pentaho-editbutton pentaho-imagebutton-disabled" title="Edit Data Source" /></td>
                    <td style="padding-right:2px"><img id="addDS" src="../../analyzer/images/spacer.gif" class="pentaho-addbutton" title="Create Data Source" /></td>
                    <td><img id="deleteDS" src="../../analyzer/images/spacer.gif" class="pentaho-deletebutton pentaho-imagebutton-disabled" title="Delete Data Source" /></td>
                </tr>
            </tbody></table>
            <table style="padding-bottom: 5px;" width="100%">
                <tbody><tr>
                    <td><select id="datasources" name="datasource" size="8" style="width:100%"><option value="0" title="BA Operations Mart - Component">pentaho_operations_mart: BA Operations Mart - Component</option><option value="1" title="BA Operations Mart - Content">pentaho_operations_mart: BA Operations Mart - Content</option><option value="2" title="BA Operations Mart - User Session">pentaho_operations_mart: BA Operations Mart - User Session</option><option value="3" title="PDI Operations Mart - Job Entry">pentaho_operations_mart: PDI Operations Mart - Job Entry</option><option value="4" title="PDI Operations Mart - Performance">pentaho_operations_mart: PDI Operations Mart - Performance</option><option value="5" title="PDI Operations Mart - Step">pentaho_operations_mart: PDI Operations Mart - Step</option><option value="6" title="PDI_Operations_Mart">pentaho_operations_mart: PDI_Operations_Mart</option><option value="7" title="Quadrant Analysis">SampleData: Quadrant Analysis</option><option value="8" title="SteelWheelsSales">SteelWheels: SteelWheelsSales</option></select></td>
                </tr>
            </tbody></table>
        </div>
        <input id="inputAutoRefresh" type="checkbox" checked="" style="vertical-align: middle;margin-left: 21px; margin-right: 5px;" /><label for="inputAutoRefresh">Auto Refresh Report</label>
    </div>

    <div class="controls clearfix">
        <div class="buttons">
            <button id="btnNext" class="pentaho-button">OK</button>
            <button id="btnCancel" class="pentaho-button">Cancel</button>
        </div>
    </div>
</div>

<script type="text/javascript">
var catalogs = [{"schema":{"cubes":[{"name":"PDI_Operations_Mart","id":"PDI_Operations_Mart"},{"name":"PDI Operations Mart - Performance","id":"PDI Operations Mart - Performance"},{"name":"PDI Operations Mart - Job Entry","id":"PDI Operations Mart - Job Entry"},{"name":"PDI Operations Mart - Step","id":"PDI Operations Mart - Step"},{"name":"BA Operations Mart - Content","id":"BA Operations Mart - Content"},{"name":"BA Operations Mart - User Session","id":"BA Operations Mart - User Session"},{"name":"BA Operations Mart - Component","id":"BA Operations Mart - Component"}],"name":"pentaho_operations_mart","roleNames":[{"bytes":[{},{},{},{},{},{},{},{},{},{},{},{},{}],"empty":false},{"bytes":[{},{},{},{},{},{},{},{},{},{},{},{},{}],"empty":false},{"bytes":[{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{}],"empty":false}]},"name":"pentaho_operations_mart"},{"schema":{"cubes":[{"name":"SteelWheelsSales","id":"SteelWheelsSales"}],"name":"SteelWheels","roleNames":null},"name":"SteelWheels"},{"schema":{"cubes":[{"name":"Quadrant Analysis","id":"Quadrant Analysis"}],"name":"SampleData","roleNames":null},"name":"SampleData"}];
var datasourceSelect = document.getElementById("datasources");
var datasources = [];

require(["dojo/ready", "dojo/on", "dojo/dom-class", "dojo/dom", "dojo/request", "common-ui/util/URLEncoder"],
  function(ready, on, domClass, dom, request, Encoder){

    function sortDatasources(a, b) {
        var aLabel = a.catalog.toUpperCase() + ": " + a.cube.toUpperCase();
        var bLabel = b.catalog.toUpperCase() + ": " + b.cube.toUpperCase();
        if (aLabel &lt; bLabel)
            return -1;
        if (aLabel &gt; bLabel)
            return 1;
        return 0;
    }

    ready(function() {

        // Flatten catalogs and cubes into an array of datasources
        for (var i = 0; i &lt; catalogs.length; i++) {
            var cubes = catalogs[i].schema.cubes;
            for (var j = 0; j &lt; cubes.length; j++) {
                var id = cubes[j].name;
                if (typeof cubes[j].id != "undefined") {
                    id = cubes[j].id;
                }
                datasources.push({"catalog":catalogs[i].name, "cube":cubes[j].name, "cube_id":id});
            }
        }

        // Sort datasources
        datasources.sort(sortDatasources);
        buildList();
        // Show the cancel button in PUC which on click will close the current tab
        if (console_enabled &amp;&amp; window.parent.closeTab) {
            domClass.remove(dom.byId('btnCancel'), "hidden");
            on(dom.byId("btnCancel"), "click", function() {
                window.parent.closeTab();
            });
        }
        //Show the cancel button in Mobile which on click will close the current tab
        if (isRunningIFrameInSameOrigin &amp;&amp; window.parent &amp;&amp; window.parent.PentahoMobile) {
            domClass.remove(dom.byId('btnCancel'), "hidden");
            on(dom.byId("btnCancel"), "click", function() {
                window.parent.PentahoMobile.OpenPanel.closeActive();
            });
        }
        if (!window.parent.closed) {
            domClass.remove(dom.byId('btnCancel'), "hidden");
            on(dom.byId("btnCancel"), "click", function() {
                window.history.go(-1);
            });
        }
    });

    /*
     * window.location.href with relative URLs is problematic when called from scripts operating in
     * different window scopes (GWT iframes). The proper window is worked on but the url is crafted
     * with the location of the inner scope.
     */
    function openLocation(loc) {
        if(console_enabled){
            window.parent.executeCommand("CollapseBrowserCommand")
        }
        window.location.href = loc;
    }
    ;
    function initDataAccess(hasDataAccess) {
        if (hasDataAccess) {
            domClass.remove(dom.byId("addDS"), "pentaho-imagebutton-disabled");
            on(dom.byId("addDS"), "click", onAddDS);
        }
    }

// This is the callback function that PUC will call when creating a new datasource.
    var base = window.CONTEXT_PATH + "api/repos/xanalyzer/";
    function openDatasourceEditorCallback(bool, transport) {
        var params = {
          showFieldList: true,
          showFieldLayout: true,
          catalog: (transport.schemaName ? transport.schemaName : transport.categoryId),
          cube: (transport.schemaName ? transport.schemaName : transport.categoryId)
        }
        var url = Encoder.encode(base + "editor", null, params);
        openLocation(url);
    }

    function onAddDS() {
        var funct = (console_enabled &amp;&amp; window.parent.pho &amp;&amp; window.parent.pho.openDatasourceEditor) ? window.parent.pho.openDatasourceEditor : pho.openDatasourceEditor;

        funct(new function() {
            this.onError = function(err) {
                alert(err);
            }
            this.onCancel = function() {
            }
            this.onReady = function() {
            }
            this.onFinish = function(bool, transport) {
                document.location.reload();
            }
        }, false);
    }

    function buildList() {

        var datasourceOptions = datasourceSelect.options;
        while (datasourceOptions.length &gt; 0) {
            datasourceOptions[datasourceOptions.length - 1] = null;
        }
        var listIdx = 0;
        for (var i = 0; i &lt; datasources.length; i++,listIdx++) {
            var opt = new Option(datasources[i].catalog + ': ' + datasources[i].cube, i);
            opt.title = datasources[i].cube;
            datasourceOptions[listIdx] = opt;
        }
        datasourceSelect.selectedIndex = 0;
        on(dom.byId("datasources"), "click", cubeSelected);
        on(dom.byId("datasources"), "dblclick", createReport);
        on(dom.byId("btnNext"), "click", createReport);
        cubeSelected();
    }

    function createReport() {
        var catalog = datasources[datasourceSelect.value].catalog;
        var cube = datasources[datasourceSelect.value].cube_id;
        var input = dom.byId("inputAutoRefresh");
        var showRepoButtons = /showRepositoryButtons=true/.test(window.location.href);
        var params = {
            showFieldList: true,
            showFieldLayout: true,
            catalog: catalog,
            cube: cube,
            autoRefresh: input.checked,
            showRepositoryButtons: showRepoButtons ? "true" : ""
        }
        var openLocationUrl = Encoder.encode(base + "editor", null, params);
        openLocation(openLocationUrl);
    }

    function cubeSelected() {

        domClass.add(dom.byId("editDS"), "pentaho-imagebutton-disabled");
        if(window.editHandle)
            editHandle.remove();

        domClass.add(dom.byId("deleteDS"), "pentaho-imagebutton-disabled");
        if(window.deleteHandle)
            deleteHandle.remove();

        ajaxLoad("service/ajax/lookupXmiId", {catalog:datasources[datasourceSelect.value].catalog,cube:datasources[datasourceSelect.value].cube}, false, function(data) {
            if (data) {
                window.catalogId = data;

                domClass.remove(dom.byId("editDS"), "pentaho-imagebutton-disabled");
                editHandle = on(dom.byId("editDS"), "click", onEditDs);

                domClass.remove(dom.byId("deleteDS"), "pentaho-imagebutton-disabled");
                deleteHandle = on(dom.byId("deleteDS"), "click", onDeleteDs);

            }
        });


    }
    function ajaxLoad(cmd, param, sync, /*optional*/callback) {
        var _data = null;
        param.stok = cv.securityToken;
        request(cv.contextPath + cmd,{
            method: "POST",
            mimetype: "text/plain",
            sync: sync, // blocking UI or not
            headers: {"Content-Encoding": "utf8"},
            data: param
        }).then(function(data){
            if (sync) {
                _data = data;
            } else {
                callback(data);
            }
        }, function(err){
            // handle an error condition
        }, function(evt){
            // handle a progress event
        });

        if (sync)
            return _data;
    }

    function onEditDs() {
        var openFunct = console_enabled &amp;&amp; window.parent.pho &amp;&amp; window.parent.pho.openEditDatasourceEditor
                ? window.parent.pho.openEditDatasourceEditor
                : window.pho.openEditDatasourceEditor;

        var callback = new function() {
            this.onOk = function(json, mqlStr) {
                alert(json + "\n\n\n" + mqlStr);
            }
            this.onError = function(err) {
                alert(err);
            }
            this.onCancel = function() {
            }
            this.onReady = function() {
            }
            this.onFinish = function(status) {

            }
            this.onFinish = function(status, transport) {

            }
        };

        try {
            openFunct(catalogId, "", callback, "ANALYSIS");
        } catch (err) {
            // backward compatibility safety net
            openFunct(catalogId, "", callback);
        }
    }

    function onDeleteDs() {
        var funct = console_enabled &amp;&amp; window.parent.pho &amp;&amp; window.parent.pho.deleteModel
                ? window.parent.pho.deleteModel
                : window.pho.deleteModel;

        var callback = new function() {
            this.onOk = function(json, mqlStr) {
                alert(json + "\n\n\n" + mqlStr);
            }
            this.onError = function(err) {
                alert(err);
            }
            this.onCancel = function() {
                alert("Canceled");
            }
            this.onReady = function() {
            }
            this.onFinish = function(status) {
                document.location.reload();
            }
            this.onFinish = function(status, transport) {
                document.location.reload();
            }
        };

        var gwtCallback = new function() {
            this.onOk = function(value) {
                funct(catalogId, catalogId, callback);
            }
            this.onCancel = function() {
                //nothing
            }
        };

        var message = "Are you sure you want to permanently delete {0}?";
        message = message.replace(/\{(\w+)\}/g, catalogId.slice(0, -4));

        if (console_enabled) {
            window.parent.mantle_showConfirmDlg("Delete Data Source", message, "Yes", "No", gwtCallback);
        }
    }

    if (console_enabled &amp;&amp; window.parent.dataAccessAvailable) {
        domClass.remove(dom.byId("addDS"), "pentaho-imagebutton-disabled");
        on(dom.byId("addDS"), "click", onAddDS);
    } else {
        // Disable datasource integration in standalone mode
        domClass.add(dom.byId("addDS"), "hidden");
        domClass.add(dom.byId("editDS"), "hidden");
        domClass.add(dom.byId("deleteDS"), "hidden");
    }
});


</script>



</body></html>